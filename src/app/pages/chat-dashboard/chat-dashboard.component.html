<div *ngIf="auth.loggedInStatus && currentUser">

    <div class="container-fluid">
        <div class="row pt-2">
            <div class="col-md-5 col-lg-4">
                <app-user-list
                (startChatEmitter)="startChatParent($event)"></app-user-list>
                <div class="text-center">
                   <h3 class="h3text">{{currentUser.displayName}}</h3>

                <button class="btn btn-success btn-sm logoutbutton" (click)="auth.signOut()">
                    logout
                </button>
                <!-- <button class="btn btn-danger btn-sm ms-2"
                    *ngIf="!currentUser.emailVarified">Verify Email</button> -->
                </div>
                
            </div>
            <div class="col-md-7 col-lg-8">
                <div *ngIf="toUser; else notSelectUserTemplate">

                <div class="text-white">
                    <p class="mt-3 chatUser">
                        Your are chatting with : <b>
                            {{toUser.name}}
                        </b>
                    </p>
                </div>

                <div class="messages" #messageBox [ngClass]="{ 'has-chats': hasChats }">
                    <ng-container *ngFor="let chat of chats">
                        <!-- <div>
                            <p> {{chat.from===currentUser.uid?'You ':toUser.displayName}}
                            <b>{{chat?.message}}</b>
                        </p>
                    </div> -->

                    <ng-container [ngTemplateOutlet]="chat.from===this.currentUser.uid? chatFrom : chatTo"
                    [ngTemplateOutletContext]="{chat:chat,user:chat.from===this.currentUser.uid? this.currentUser:toUser}">

                    </ng-container>

                    </ng-container>
                </div>




                <div class="mt-3 pb-2">
                    <form (ngSubmit)="sendMessage($event)">
                        <div class="input-group">
                            

                           
                            <input type="text" id="message"
                            class="form-control"
                            name="message" [(ngModel)]="message" placeholder="Enter message here">
                            <button type="submit" class="btn btn-success btn-sm"
                            style="border-radius: 50%;">Send</button>
                      
                        </div>
                    </form>
                </div>

            </div>
            </div>
        </div>
    </div>

</div>

<ng-template #notSelectUserTemplate>
    <div class="card mask-custom text-white">
        <div class="card-body text-center">
            <h3 class="h3tag">Select user from user list</h3>
            <p class="ptag">To start new chat select user from left of user list pannel.</p>
        </div>
       
    </div>
</ng-template>


                <!-- test -->
                 <!-- from message box -->
                  <ng-template #chatFrom let-chat="chat" let-user="user">
                 <div class="text-white d-flex justify-content-end">
                    <div class="card mask-custom text-white"
                    style="max-width: 60%;">

                    <div class="card-header pt-3 px-3 pb-0"
                    style="border-bottom:1px solid rgba(255,255,255,0.3)">
                        <p class="fw-bold mb-0">You</p>
                        <p><i class="far fa-clock"></i><span class="ms-1">{{chat.date | date:'dd/MM/yyyy hh:mm:ss a'}}</span></p>

                    </div>
                    <div class="card-body">
                        <p class="mb-0">{{chat.message}}
                            
                        </p>
                    </div>

                    </div>
                    <img [src]="user.imageURL" alt="avatar" class="rounded-circle d-flex
                    align-self-start ms-3 shadow-1-strong" width="60">
                </div>
                </ng-template>

                <!-- to message box -->
                <ng-template #chatTo let-chat="chat" let-user="user">
                <div class="text-white d-flex justify-content-start">
                    <img [src]='user.imageURL' alt="avatar" class="rounded-circle d-flex
                    align-self-start me-3 shadow-1-strong" width="60">
                    <div class="card mask-custom text-white"
                    style="max-width: 60%;">

                    <div class="card-header pt-3 px-3 pb-0"
                    style="border-bottom:1px solid rgba(255,255,255,0.3)">
                        <p class="fw-bold mb-0">{{user.displayName}}</p>
                        <p><i class="far fa-clock"></i><span class="ms-1">{{chat.date | date:'dd/MM/yyyy hh:mm:ss a'}}</span></p>

                    </div>
                    <div class="card-body">
                        <p class="mb-0">{{chat.message}}


                        </p>
                    </div>

                    </div>
                    
                </div>
               </ng-template>
                 <!--  -->


